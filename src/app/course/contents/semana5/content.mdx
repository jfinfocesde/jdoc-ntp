import Link from 'next/link';

# MongoDB: Qué es y cómo funciona

**MongoDB** es una base de datos NoSQL de código abierto y orientada a documentos. Se utiliza para almacenar grandes volúmenes de datos con flexibilidad y escalabilidad.

## **Características clave**

-   **Orientada a documentos:** Almacena datos en documentos JSON, similar a BSON, lo que facilita el almacenamiento y la consulta de datos semiestructurados.
-   **NoSQL:** No requiere un esquema rígido, lo que la hace ideal para datos que cambian con frecuencia o que no se ajustan a un modelo relacional tradicional.
-   **Código abierto:** Disponible gratuitamente y con una gran comunidad de desarrolladores que contribuyen a su desarrollo.
-   **Escalable:** Puede manejar grandes volúmenes de datos y escalar horizontalmente agregando más servidores.
-   **Flexible:** Admite una variedad de lenguajes de programación y herramientas de desarrollo.

## **Cómo funciona**

-   **Almacenamiento de datos:** Los datos se almacenan en colecciones, que son como tablas en una base de datos relacional. Las colecciones están compuestas por documentos, que son unidades de datos que contienen pares clave-valor.
-   **Consultas:** Las consultas se realizan utilizando el lenguaje de consulta de MongoDB, que es similar a JavaScript.
-   **Indexación:** MongoDB admite la indexación de campos para mejorar el rendimiento de las consultas.
-   **Replicación:** Los datos se pueden replicar en varios servidores para mejorar la disponibilidad y la tolerancia a fallos.

## **Casos de uso**

-   Almacenamiento de datos de aplicaciones web
-   Almacenamiento de datos de IoT
-   Almacenamiento de documentos
-   Análisis de datos
-   Caché

## **Sitio web de MongoDB**

-   <Link href="https://www.mongodb.com" target='_blank'>**Sitio web de MongoDB:**</Link>


# Conexión a MongoDB con pymongo

## **¿Qué es pymongo?**

Pymongo es una librería popular de Python que te permite interactuar con bases de datos MongoDB desde tus programas de Python. MongoDB es una base de datos NoSQL orientada a documentos, conocida por su flexibilidad y escalabilidad.

<Link href="https://pymongo.readthedocs.io/en/stable/" target='_blank'>**Sitio web de Pymongo**</Link>

## **Installar pymongo**

```bash
python3 -m pip install pymongo
```

## **Pasos:**

1.  **Importar la librería pymongo:**

```python
import pymongo
```

2.  **Crear una instancia del cliente MongoClient:**

```python
client = pymongo.MongoClient("mongodb://localhost:27017")
```
3.  **Seleccionar la base de datos:**

```python
database = client["mydb"]
```

4.  **Seleccionar la colección:**

```python
collection = database["mycollection"]
```

5.  **Operaciones CRUD (Create, Read, Update, Delete)**

### **Crear:**

```python
document = {"name": "Juan Pérez", "age": 30}
collection.insert_one(document)
```

###  **Leer**

```python
documents = collection.find({})
for document in documents:
  print(document)
```

### **Actualizar**

```python
collection.update_one({"name": "Juan Pérez"}, {"$set": {"age": 31}})
```

### **Eliminar**

```python
collection.delete_one({"name": "Juan Pérez"})
```

## **Cerrar la conexión:**

```python
client.close()
```

## Ejemplo1 de conexión a MongoDB con PyMongo

```python
import pymongo

# Crear una instancia del cliente MongoClient
client = pymongo.MongoClient("mongodb://localhost:27017")

# Seleccionar la base de datos
database = client["mydb"]

# Seleccionar la colección
collection = database["mycollection"]

# Insertar un documento
document = {"name": "Juan Pérez", "age": 30}
collection.insert_one(document)

# Consultar todos los documentos
documents = collection.find({})
for document in documents:
  print(document)

# Actualizar un documento
collection.update_one({"name": "Juan Pérez"}, {"$set": {"age": 31}})

# Eliminar un documento
collection.delete_one({"name": "Juan Pérez"})

# Cerrar la conexión
client.close()
```

Este código realiza las siguientes acciones:

1.  Importa la librería `pymongo`.
2.  Crea una instancia del cliente `MongoClient` que se conecta al servidor MongoDB en el localhost y el puerto 27017.
3.  Selecciona la base de datos con el nombre "mydb".
4.  Selecciona la colección con el nombre "mycollection".
5.  Inserta un documento en la colección con el nombre "Juan Pérez" y la edad 30.
6.  Consulta todos los documentos en la colección e imprime cada uno en la consola.
7.  Actualiza el documento con el nombre "Juan Pérez" para cambiar su edad a 31.
8.  Elimina el documento con el nombre "Juan Pérez".
9.  Cierra la conexión al servidor MongoDB.

## Ejemplo2 de conexión a MongoDB con PyMongo

```python
import pymongo

try:
  client = pymongo.MongoClient("mongodb+srv:")
  database = client["sample_mflix"]
  collection = database["users"]
 
  documents = collection.find({})
  for document in documents:
    print(document)
except pymongo.errors.ConnectionFailure as e:
    print(f"Connection error: {e}")
except pymongo.errors.PyMongoError as e:
    print(f"MongoDB error: {e}")
except Exception as e:
    print(f"Unexpected error: {e}")  # Catch any other exceptions
finally:
    # Always close the connection, even if errors occur
    if client:
        client.close()
        print("Connection closed.")
```


